#- name: Install the package "python 2.7"
#  sudo: yes
#  raw: sudo apt-get update && sudo apt-get -y install python-2.7

- name: SSH | Ssh-copy-id ~/.ssh
  authorized_key:
    user: anyuan
    state: present
    key: "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') }}"

## Kubeadm don't use cfssl
#- name: Check CFSSL exists
#  become: yes
#  stat:
#    path: "/usr/local/bin/cfssl"
#  register: cfssl_stat

#- name: 安装 CFSSL
#  become: yes
#  copy: src=bin/{{ item }} dest=/usr/local/bin/{{ item }} mode=0755
#  with_items:
#  - cfssl
#  - cfssl-certinfo
#  - cfssljson
#  when: cfssl_stat.stat.exists == False

- name: APT | Replace with USTC mirror
  become: yes
  copy: src=sources.list-16.04 dest=/etc/apt/sources.list mode=0644
  tags: config-apt

- name: APT | Add USTC Public Key
  become: yes
  shell: apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 7EA0A9C3F273FCD8 6A030B21BA07F4FB
  tags: config-apt

- name: APT | Ready for apt-get update
  become: yes
  shell: dpkg --remove-architecture i386

- name: APT | Apt-get update
  become: yes
  apt:
    update_cache: yes
    cache_valid_time: 3600

- name: Config | Set alias
  become: yes
  copy: src=alias.rc dest=/etc/profile.d/alias.sh mode=0644
  tags: config-alias

- name: Config | Enable alias
  become: yes
  lineinfile:
    dest: /root/.bashrc
    regexp: '^.*alias\.sh.*$'
    line: 'source /etc/profile.d/alias.sh'
    state: present
  tags: config-alias

- name: Config | Enable alias
  become: yes
  lineinfile:
    dest: /home/anyuan/.bashrc
    regexp: '^.*alias\.sh.*$'
    line: 'source /etc/profile.d/alias.sh'
    state: present
  tags: config-alias

- name: Config | Set gitconfig
  become: yes
  copy: src=gitconfig dest=/root/.gitconfig mode=0644
  tags: config-git

- import_tasks: hostname.yml


